# CP/M-80 on CP/M-86

汎用CP/M-86環境下で CP/M-80を動作させるプログラムです。  

## 本ソフトウエアの特長

ドライブ構成に関してはドライブ文字含め元のCP/M-86の構成を  
そのまま引き継ぎます。（制限あり：後述）  

機種によっては起動時にフロッピーメディア判定を行うため、  
ドライブにメディアを挿入しておく必要があります。  

PC-98x1に関しては機種判定を行いドライブの接続状況を調査し、  
メディア判定しているため、メディア未挿入でも問題ありません。  

PC-98x1非該当判定の場合は、機種依存処理はしていませんが  
実機所有していない機種に関しては動作確認していません。  

## ビルド環境

OS：CP/M-86 1.1  
アセンブラ：ASM86.CMD (CP/M-86 標準添付）  
実行ファイル作成：GENCMD.CMD (CP/M-86 標準添付）

ファイル構成  
CPM80.A86 ---- ソースファイル  
CPM80.LST ---- ASM86が生成するリスティングファイル  
CPM80.H86 ---- ASM86が生成するHEXファイル  
CPM80.CMD ---- ASM86が生成するCP/M-86実行形式ファイル  
Z80EM.BIN ---- Z80命令実行エミュレーター  
CPM80-64.BIN - CP/M-80のBDOSおよびCCP  
86.COM ------- CP/M-86に戻るコマンド  

コマンドラインにて
ASM86  CPM86  
GENCMD CPM86 8080    (8080：CP/M-86での8080メモリモデル指定オプション）  
によりCPM80.CMDが生成されます。  

## 使い方

CP/M-86環境にて、カレントドライブに Z80エミュレータであるZ80EM.BINおよび  
CP/M-80のBDOSとCCPである CPM80-64.BINを置き  
CPM80 として実行ください。  

本プログラム自身のの実行時オプション（パラメータ）はありません。  
本ソフトではZ80の命令をソフトウエアエミュレータで実行し CP/M-80を動作させます。  

## Z80エミュレータ

Z80命令を解釈実行する部分は別モジュールとして分離しています。  
詳細は下記リポジトリをご参照ください。  
https://github.com/Gazelle8087/Z80-instruction-executor-for-x86

## CP/M-80のBDOSおよびCCP

下記リポジトリの CPM22_CCP_BDOS.BIN をCP/Mで扱えるよう  
（8文字+拡張子3文字）にリネームしたものです。  
https://github.com/Gazelle8087/SBC8080-CPM/tree/main/z80

## ライセンス

CPM80.* に関してはMITとします。  

Z80エミュレーターはMITとします。  

CP/MのBDOS,CCPに関してのライセンス条項に関しては  
The Unofficial CP/M Web site http://www.cpm.z80.de/ をご参照ください。

## ドライブ構成の制限

64K CPMを実現するためBIOSエリア(0FA00H～)のメモリ容量制限が厳しく  
ドライブごとに確保する必要があるワークエリアが不足する場合があり  
その場合は当該ドライブを無視します。  
ただし、標準的な構成の場合はその制限がかかることはあまりないと思われます。

構成引き継ぎ可能を確認済の例  

PC-9801(実機ではなく Neko Project 21/W)  
20MB SASI-HDD 2台+1MB FDD 2台(8MB+8MB+4MB+8MB+8MB+4MB+1MB+1MB)  
HDD起動FDD起動いずれも正しく引継ぎ。  

以前はPC-98x1実機で動作させていましたが、  
現在は実機を所有ぜず NP21/Wを使っています。  
なお、実機で動作させたバイナリがそのままNP21/Wで動作しました。  

Aki.hさん作 EMU57Q-8088/V20(実機)  
250KB FDD 4台+4MB HDD 2台 (250KB×4 4MB×2）  
途中ドライブ番号に飛びがあっても正しく引継ぎ。  

## PC-98x1判定方法

以下を満たす場合、PC-98x1と判定し、起動時 PC-98x1 running と表示します。  
(1) INT DC と INT DC のベクトルが異なる  
(2) CP/M-86のBIOSが セグメント 0060Hに配置されている  

そのため、PC-98x1以外の機種でも上記に該当する場合は誤判定します。

## 参考情報

EMU57Q-8088/V20  
Aki.hさんが開発され、CP/M-86 および MS-DOS が移植されています。  
https://github.com/akih-san/EMU57Q-Rrv2.1_CPM_MSDOS

Neko Project 21/W
SimKさんが開発され現在も改良が続いているPC-98x1エミュレータです。  
実機再現性が高く素晴らしい完成度です。  
https://simk98.github.io/np21w/

## 変更履歴
2025/5/23 Rev. 1.00	初回公開


